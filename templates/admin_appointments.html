<!DOCTYPE html>
<html>
<head>
  <title>Admin Appointments - EasyBook</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">

    <div class="d-flex justify-content-between align-items-center">
      <h1 class="mb-0">Manage Appointments</h1>
      <div>
        <a class="btn btn-secondary" href="/admin">Back</a>
        <a class="btn btn-danger" href="/logout">Logout</a>
      </div>
    </div>

    <form class="row g-2 mt-3" method="GET">
      <div class="col-md-8">
        <input class="form-control" name="q" placeholder="Search by user name or email..." value="{{ q }}">
      </div>
      <div class="col-md-4">
        <button class="btn btn-primary w-100">Search</button>
      </div>
    </form>

    <hr class="my-4">

    <div class="table-responsive">
      <table class="table table-striped table-bordered bg-white align-middle">
        <thead>
          <tr>
            <th style="width: 90px;">ID</th>
            <th>Appointment</th>
            <th style="width: 160px;">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for a in appointments %}
          <tr>
            <td>{{ a.id }}</td>
            <td>
              <!-- User -->
              {% if a.account is defined and a.account %}
                <div><strong>Name:</strong> {{ a.account.first_name }} {{ a.account.last_name }}</div>
                <div><strong>User ID:</strong> {{ a.account.id }}</div>
                <div><strong>Email:</strong> {{ a.account.email }}</div>
              {% else %}
                {% if a.user_id is defined %}
                  <div><strong>User ID:</strong> {{ a.user_id }}</div>
                {% endif %}
                {% if a.email is defined %}
                  <div><strong>Email:</strong> {{ a.email }}</div>
                {% endif %}
              {% endif %}

              <!-- Date/Time -->
              {% if a.date is defined %}
                <div><strong>Date:</strong> {{ a.date }}</div>
              {% endif %}

              {% if a.start_time is defined %}
                <div><strong>Time:</strong> {{ a.start_time }}{% if a.end_time is defined %} â€“ {{ a.end_time }}{% endif %}</div>
              {% endif %}
            </td>

            <td>
              <form method="POST" action="/admin/appointments/{{ a.id }}/cancel" onsubmit="return confirm('Cancel this appointment?');">
                <button class="btn btn-danger btn-sm">Cancel</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="3">No appointments found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</body>
</html>